<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ ‚Äî –ó–∞—è–≤–∫–∞–ó–∞–ú–∏–Ω—É—Ç—É</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Header -->
    <header class="header fixed-header">
        <div class="container header-container">
            <div class="header-content">
                <a href="index.html" class="logo-container">
                    <div class="logo-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                        </svg>
                    </div>
                    <span class="logo-text">–ó–∞—è–≤–∫–∞–ó–∞–ú–∏–Ω—É—Ç—É</span>
                </a>
                <nav class="header-nav">
                    <a href="index.html#main" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
                    <a href="index.html#pricing" class="nav-link">–¢–∞—Ä–∏—Ñ—ã</a>
                </nav>
                <a href="calculate.html" class="try-button">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å</a>
            </div>
        </div>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="activate-page">
        <div class="container activate-container">
            <div class="activate-header">
                <h1 class="activate-title">üîê –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏</h1>
                <p class="activate-subtitle">–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
            </div>

            <div class="activate-card">
                <form id="activateForm" class="activate-form">
                    <div class="form-field">
                        <label for="username" class="form-label">
                            Telegram Username
                        </label>
                        <div class="input-wrapper">
                            <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="m22 2-7 20-4-9-9-4Z"/>
                                <path d="M22 2 11 13"/>
                            </svg>
                            <input
                                type="text"
                                id="username"
                                name="username"
                                placeholder="username"
                                class="form-input"
                                autocomplete="username"
                            />
                        </div>
                    </div>

                    <div class="form-field">
                        <label for="tariff" class="form-label">
                            –¢–∞—Ä–∏—Ñ
                        </label>
                        <div class="input-wrapper">
                            <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                            <select id="tariff" name="tariff" class="form-input" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ</option>
                                <option value="start">–°—Ç–∞—Ä—Ç</option>
                                <option value="business">–ë–∏–∑–Ω–µ—Å</option>
                                <option value="pro">–ü—Ä–æ</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-field">
                        <label for="tariff_name" class="form-label">
                            –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
                        </label>
                        <div class="input-wrapper">
                            <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 7h16"/>
                                <path d="M10 11h6"/>
                                <path d="M10 15h6"/>
                                <path d="M5 3h14a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/>
                            </svg>
                            <input
                                type="text"
                                id="tariff_name"
                                name="tariff_name"
                                class="form-input"
                                readonly
                            />
                        </div>
                        <p class="form-hint">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ç–∞—Ä–∏—Ñ–∞</p>
                    </div>

                    <!-- Alert –æ—à–∏–±–∫–∏ -->
                    <div class="alert alert-error" id="errorAlert" style="display: none;">
                        <svg class="alert-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="8" x2="12" y2="12"/>
                            <line x1="12" y1="16" x2="12.01" y2="16"/>
                        </svg>
                        <span class="alert-message" id="errorMessage"></span>
                    </div>

                    <!-- Alert —É—Å–ø–µ—Ö–∞ -->
                    <div class="alert alert-success" id="successAlert" style="display: none;">
                        <svg class="alert-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        <div class="alert-message" id="successMessage"></div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
                    <button type="submit" class="submit-button" id="submitBtn">
                        <svg class="submit-button-loader" id="submitLoader" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
                            <line x1="12" y1="2" x2="12" y2="6"/>
                            <line x1="12" y1="18" x2="12" y2="22"/>
                            <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/>
                            <line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/>
                            <line x1="2" y1="12" x2="6" y2="12"/>
                            <line x1="18" y1="12" x2="22" y2="12"/>
                            <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/>
                            <line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/>
                        </svg>
                        <span id="submitButtonText">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        const form = document.getElementById('activateForm');
        const resultDiv = document.getElementById('successAlert');
        const errorDiv = document.getElementById('errorAlert');
        const submitBtn = document.getElementById('submitBtn');
        const submitLoader = document.getElementById('submitLoader');
        const submitButtonText = document.getElementById('submitButtonText');
        const usernameInput = document.getElementById('username');
        const tariffSelect = document.getElementById('tariff');
        const tariffNameInput = document.getElementById('tariff_name');

        // –¢–∞—Ä–∏—Ñ—ã –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
        const tariffs = {
            'start': '–°—Ç–∞—Ä—Ç',
            'business': '–ë–∏–∑–Ω–µ—Å',
            'pro': '–ü—Ä–æ'
        };

        // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞
        tariffSelect.addEventListener('change', (e) => {
            const selectedTariff = e.target.value;
            if (selectedTariff && tariffs[selectedTariff]) {
                tariffNameInput.value = tariffs[selectedTariff];
            } else {
                tariffNameInput.value = '';
            }
        });

        // –°–∫—Ä—ã—Ç–∏–µ –∞–ª–µ—Ä—Ç–æ–≤
        function hideAlerts() {
            resultDiv.style.display = 'none';
            errorDiv.style.display = 'none';
        }

        // –ü–æ–∫–∞–∑ –æ—à–∏–±–∫–∏
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            errorDiv.style.display = 'flex';
            resultDiv.style.display = 'none';
            errorDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // –ü–æ–∫–∞–∑ —É—Å–ø–µ—Ö–∞
        function showSuccess(message, data) {
            let messageHTML = `<strong>‚úÖ ${message}</strong>`;
            if (data) {
                messageHTML += `<pre style="margin-top: 12px; font-size: 12px; background: rgba(255,255,255,0.5); padding: 12px; border-radius: 8px; overflow-x: auto;">${JSON.stringify(data, null, 2)}</pre>`;
            }
            document.getElementById('successMessage').innerHTML = messageHTML;
            resultDiv.style.display = 'flex';
            errorDiv.style.display = 'none';
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            hideAlerts();
            
            const username = usernameInput.value.trim();
            const tariff = tariffSelect.value.trim();
            const tariff_name = tariffNameInput.value.trim();

            if (!username) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ Telegram username');
                return;
            }

            if (!tariff) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ');
                return;
            }

            submitBtn.disabled = true;
            submitLoader.style.display = 'inline-block';
            submitButtonText.textContent = '–ê–∫—Ç–∏–≤–∏—Ä—É–µ–º...';

            try {
                const response = await fetch('https://new-landing-production.up.railway.app/api/activate_subscription', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        telegram_username: username,
                        tariff: tariff,
                        tariff_name: tariff_name
                    })
                });

                const data = await response.json();
                
                if (response.ok && (data.success || !data.error)) {
                    showSuccess('–ü–æ–¥–ø–∏—Å–∫–∞ —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!', data);
                    form.reset();
                    tariffNameInput.value = '';
                } else {
                    const errorMsg = data.error || data.message || '–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏';
                    showError(errorMsg + (data.details ? ': ' + data.details : ''));
                }
            } catch (error) {
                console.error('Error:', error);
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitLoader.style.display = 'none';
                submitButtonText.textContent = '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É';
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è username (—É–±–∏—Ä–∞–µ–º @ –µ—Å–ª–∏ –µ—Å—Ç—å)
        usernameInput.addEventListener('input', (e) => {
            let value = e.target.value.trim();
            if (value.startsWith('@')) {
                value = value.substring(1);
                e.target.value = value;
            }
            hideAlerts();
        });
    </script>
</body>
</html>



